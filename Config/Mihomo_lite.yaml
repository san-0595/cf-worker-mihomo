# mihomo (Clash Meta) æ‡’äººé…ç½®
# ç‰ˆæœ¬ï¼šv1.19.4
# ä½œè€…ï¼šKwisma
# é¢‘é“ï¼šhttps://t.me/Marisa_kristi
# é…ç½®ï¼šhttps://cdn.jsdmirror.cn/gh/Kwisma/cf-worker-mihomo/main/main/Config/Mihomo.yaml
# Githubï¼šhttps://github.com/Kwisma/cf-worker-mihomo
# ä¿®æ”¹è‡ªå®˜æ–¹ç¤ºä¾‹è§„åˆ™ https://wiki.metacubex.one/example/#meta
# ä¸ç†è§£çš„åœ°æ–¹å»ºè®®å¯¹ç…§ è™šç©ºç»ˆç«¯ (Clash Meta) Docs è¿›è¡Œç†è§£
# è™šç©ºç»ˆç«¯ (Clash Meta) Docs åœ°å€: https://wiki.metacubex.one
# è½¬è½½è¯·ä¿ç•™æ­¤æ³¨é‡Šæµ‹
# æ³¨æ„ï¼šå¿…é¡»å…³é—­ DNS è¦†å†™æ‰èƒ½é˜²æ­¢ DNS æ³„æ¼

# ------------------------------------------------------------
# é”šç‚¹åŒº
proxy: &proxy { type: select, include-all: true, proxies: [ğŸš€å…¨çƒä»£ç†, ğŸ¯å…¨çƒç›´è¿, â™»ï¸è‡ªåŠ¨é€‰æ‹©, âš¡ï¸å‡è¡¡è´Ÿè½½, ğŸ”¯æ•…éšœè½¬ç§», ğŸ‡­ğŸ‡°é¦™æ¸¯è‡ªåŠ¨, ğŸ‡¹ğŸ‡¼å°æ¹¾è‡ªåŠ¨, ğŸ‡¯ğŸ‡µæ—¥æœ¬è‡ªåŠ¨, ğŸ‡ºğŸ‡¸ç¾å›½è‡ªåŠ¨, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡è‡ªåŠ¨, ğŸ‡°ğŸ‡·éŸ©å›½è‡ªåŠ¨, ğŸŒå…¶å®ƒåœ°åŒº], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
direct: &direct { type: select, include-all: true, proxies: [ğŸ¯å…¨çƒç›´è¿, ğŸš€å…¨çƒä»£ç†, â™»ï¸è‡ªåŠ¨é€‰æ‹©, âš¡ï¸å‡è¡¡è´Ÿè½½, ğŸ”¯æ•…éšœè½¬ç§», ğŸ‡­ğŸ‡°é¦™æ¸¯è‡ªåŠ¨, ğŸ‡¹ğŸ‡¼å°æ¹¾è‡ªåŠ¨, ğŸ‡¯ğŸ‡µæ—¥æœ¬è‡ªåŠ¨, ğŸ‡ºğŸ‡¸ç¾å›½è‡ªåŠ¨, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡è‡ªåŠ¨, ğŸ‡°ğŸ‡·éŸ©å›½è‡ªåŠ¨, ğŸŒå…¶å®ƒåœ°åŒº], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
ipcidr_mrs: &ipcidr_mrs { type: http, interval: 86400, behavior: ipcidr, format: mrs, proxy: ğŸ¯å…¨çƒç›´è¿ }
domain_mrs: &domain_mrs { type: http, interval: 86400, behavior: domain, format: mrs, proxy: ğŸ¯å…¨çƒç›´è¿ }
# å»¶è¿Ÿæ£€æµ‹ URL
p: &p
  type: http
  interval: 3600 # æ›´æ–°providerçš„æ—¶é—´
  size-limit: 0 # é™åˆ¶ä¸‹è½½æ–‡ä»¶çš„æœ€å¤§å¤§å°ï¼Œé»˜è®¤ä¸º 0 å³ä¸é™åˆ¶æ–‡ä»¶å¤§å°ï¼Œå•ä½ä¸ºå­—èŠ‚ (b)
  header: # è‡ªå®šä¹‰ http è¯·æ±‚å¤´
    User-Agent:
      - meta;clash.meta;Clash/v1.18.0;clash
  health-check: # å¥åº·æ£€æŸ¥ (å»¶è¿Ÿæµ‹è¯•)
    enable: true
    url: https://www.gstatic.com/generate_204 # å¥åº·æ£€æŸ¥æµ‹è¯•åœ°å€
    interval: 300 # å¥åº·æ£€æŸ¥é—´éš”
    timeout: 5000 # å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´
    lazy: true # æ‡’æƒ°çŠ¶æ€
override: &override
  tfo: false # å¯ç”¨ TCP Fast Open, ä»…ç”Ÿæ•ˆäº TCP åè®®
  mptcp: false # å¯ç”¨ TCP Multi Path, ä»…ç”Ÿæ•ˆäº TCP åè®®
  udp: true # æ˜¯å¦å…è®¸ UDP é€šè¿‡ä»£ç†ï¼Œé»˜è®¤ä¸º false
  udp-over-tcp: false # å¯ç”¨ UDP over TCPï¼Œé»˜è®¤ false
  skip-cert-verify: true # è·³è¿‡è¯ä¹¦éªŒè¯ï¼Œä»…é€‚ç”¨äºä½¿ç”¨ tls çš„åè®®
  ip-version: ipv4-prefer # å¯é€‰ï¼šdual/ipv4/ipv6/ipv4-prefer/ipv6-prefer ,é»˜è®¤ä½¿ç”¨ dual, ipv4: ä»…ä½¿ç”¨ IPv4, ipv6: ä»…ä½¿ç”¨ IPv6, ipv4-prefer: ä¼˜å…ˆä½¿ç”¨ IPv4ï¼Œå¯¹äº TCP ä¼šè¿›è¡ŒåŒæ ˆè§£æï¼Œå¹¶å‘é“¾æ¥ä½†æ˜¯ä¼˜å…ˆä½¿ç”¨ IPv4 é“¾æ¥ï¼ŒUDP åˆ™ä¸ºåŒæ ˆè§£æï¼Œè·å–ç»“æœä¸­çš„ç¬¬ä¸€ä¸ª IPv4, ipv6-prefer:ä¼˜å…ˆä½¿ç”¨ IPv6ï¼Œå¯¹äº TCP ä¼šè¿›è¡ŒåŒæ ˆè§£æï¼Œå¹¶å‘é“¾æ¥ä½†æ˜¯ä¼˜å…ˆä½¿ç”¨ IPv6 é“¾æ¥ï¼ŒUDP åˆ™ä¸ºåŒæ ˆè§£æï¼Œè·å–ç»“æœä¸­çš„ç¬¬ä¸€ä¸ª IPv6
# URL æµ‹è¯•é…ç½®
u: &u
  type: url-test # æµ‹è¯•ç±»å‹
  tolerance: 1 # è‡ªåŠ¨é€‰æ‹©åˆ‡æ¢å®¹å·®
  strategy: consistent-hashing # è´Ÿè½½å‡è¡¡ç­–ç•¥
  url: https://www.gstatic.com/generate_204 #å¥åº·æ£€æŸ¥æµ‹è¯•åœ°å€
  interval: 300 #å¥åº·æ£€æŸ¥é—´éš”ï¼Œå¦‚ä¸ä¸º 0 åˆ™å¯ç”¨å®šæ—¶æµ‹è¯•ï¼Œå•ä½ä¸ºç§’
  lazy: true # æ‡’æƒ°çŠ¶æ€
  timeout: 5000 # å¥åº·æ£€æŸ¥è¶…æ—¶æ—¶é—´ï¼Œå•ä½ä¸ºæ¯«ç§’
  max-failed-times: 5 # æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¶…è¿‡åˆ™è§¦å‘ä¸€æ¬¡å¼ºåˆ¶å¥åº·æ£€æŸ¥ï¼Œé»˜è®¤ 5
  include-all: true # å¼•å…¥æ‰€æœ‰ä»£ç†é›†åˆ

######################## start ########################
# è®¢é˜…é“¾æ¥é…ç½®åŒº
proxy-providers:
  # ç¬¬ä¸€ä¸ªä»£ç†æä¾›è€…
  provider1:
    <<: *p # ç»§æ‰¿é€šç”¨é…ç½®
    url: [è®¢é˜…é“¾æ¥]
    path: ./proxies/provider1.yaml
    override:
      <<: *override
      additional-suffix: ' 1' # èŠ‚ç‚¹åæ·»åŠ åç¼€

#  provider2:
#    <<: *p # ç»§æ‰¿é€šç”¨é…ç½®
#    url: [è®¢é˜…é“¾æ¥]
#    path: ./proxies/provider2.yaml
#    override:
#      <<: *override
#      additional-suffix: ' 2' # èŠ‚ç‚¹åæ·»åŠ åç¼€

######################## end ########################

#redir-port: 9797 # é‡å®šå‘ç«¯å£ï¼Œç”¨äºé€æ˜ä»£ç†
#tproxy-port: 9898 # TProxy ç«¯å£ï¼Œæ”¯æŒ TUN æ¨¡å¼

port: 7892 # HTTP ä»£ç†ç«¯å£
socks-port: 7893 # SOCKS5 ä»£ç†ç«¯å£
mixed-port: 7890 # HTTP/SOCKS æ··åˆä»£ç†ç«¯å£
allow-lan: true # å…è®¸å±€åŸŸç½‘è®¾å¤‡è¿æ¥ä»£ç†
bind-address: "*" # ç»‘å®šåœ°å€ï¼Œé»˜è®¤ä¸ºæ‰€æœ‰ IP åœ°å€
#authentication:
#  - "username:password" # HTTP/SOCKS ä»£ç†è®¤è¯ï¼Œæ ¼å¼ä¸º ç”¨æˆ·å:å¯†ç 
#skip-auth-prefixes:
#  - 127.0.0.1/8 # è·³è¿‡æœ¬åœ°åœ°å€çš„è®¤è¯
#  - ::1/128 # è·³è¿‡ IPv6 æœ¬åœ°åœ°å€çš„è®¤è¯
#lan-allowed-ips:
#  - 0.0.0.0/0 # å…è®¸å±€åŸŸç½‘è®¿é—®çš„ IP åœ°å€èŒƒå›´ (IPv4)
#  - ::/0 # å…è®¸å±€åŸŸç½‘è®¿é—®çš„ IP åœ°å€èŒƒå›´ (IPv6)
#lan-disallowed-ips:
#  - 192.168.0.3/32 # å±€åŸŸç½‘ç¦æ­¢è®¿é—®çš„ç‰¹å®š IP åœ°å€

# always å¼€å¯ï¼Œå¼ºåˆ¶åŒ¹é…æ‰€æœ‰è¿›ç¨‹
# strict é»˜è®¤ï¼Œç”± Clash åˆ¤æ–­æ˜¯å¦å¼€å¯
# off ä¸åŒ¹é…è¿›ç¨‹ï¼Œæ¨èåœ¨è·¯ç”±å™¨ä¸Šä½¿ç”¨æ­¤æ¨¡å¼
find-process-mode: off
mode: rule # å·¥ä½œæ¨¡å¼ä¸ºè§„åˆ™æ¨¡å¼
geodata-mode: false # æ›´æ”¹ geoip ä½¿ç”¨æ–‡ä»¶ï¼Œmmdb æˆ–è€… datï¼Œå¯é€‰ true/false,trueä¸º dat
# standardï¼šæ ‡å‡†åŠ è½½å™¨
# memconservativeï¼šä¸“ä¸ºå†…å­˜å—é™ (å°å†…å­˜) è®¾å¤‡ä¼˜åŒ–çš„åŠ è½½å™¨ (é»˜è®¤å€¼)
geodata-loader: memconservative
geox-url: # Geo æ•°æ®åº“é…ç½®ï¼Œç”¨äºåœ°ç†ä½ç½®å’Œ ASN åŒ¹é…
  geoip: "https://cdn.jsdmirror.cn/gh/MetaCubeX/meta-rules-dat@release/geoip.dat" # GeoIP æ•°æ®åº“
  geosite: "https://cdn.jsdmirror.cn/gh/MetaCubeX/meta-rules-dat@release/geosite.dat" # GeoSite æ•°æ®åº“
  mmdb: "https://cdn.jsdmirror.cn/gh/MetaCubeX/meta-rules-dat@release/geoip.metadb" # GeoIP mmdb æ•°æ®åº“
  asn: "https://cdn.jsdmirror.cn/gh/MetaCubeX/meta-rules-dat@release/GeoLite2-ASN.mmdb" # ASN æ•°æ®åº“
geo-auto-update: false # å¼€å¯è‡ªåŠ¨æ›´æ–° Geo æ•°æ®åº“
geo-update-interval: 24 # Geo æ•°æ®åº“æ›´æ–°é—´éš” (å•ä½: å°æ—¶)
# GeoSite ä½¿ç”¨çš„åŒ¹é…å™¨å®ç°ï¼Œå¯ç”¨çš„å®ç°ï¼š
# - succinctï¼ˆé»˜è®¤ï¼Œä¸è§„åˆ™é›†ç›¸åŒï¼‰
# - mphï¼ˆæ¥è‡ª V2Rayï¼Œåœ¨ Xray ä¸­ä¹Ÿæ˜¯ `hybrid`ï¼‰
geosite-matcher: succinct

global-ua: clash.meta # è‡ªå®šå…¨å±€ UA
etag-support: true # å¤–éƒ¨èµ„æºä¸‹è½½çš„ ETag æ”¯æŒ
# silent é™é»˜ï¼Œä¸è¾“å‡º
# error ä»…è¾“å‡ºå‘ç”Ÿé”™è¯¯è‡³æ— æ³•ä½¿ç”¨çš„æ—¥å¿—
# warning è¾“å‡ºå‘ç”Ÿé”™è¯¯ä½†ä¸å½±å“è¿è¡Œçš„æ—¥å¿—ï¼Œä»¥åŠ error çº§åˆ«å†…å®¹
# info è¾“å‡ºä¸€èˆ¬è¿è¡Œçš„å†…å®¹ï¼Œä»¥åŠ error å’Œ warning çº§åˆ«çš„æ—¥å¿—
# debug å°½å¯èƒ½çš„è¾“å‡ºè¿è¡Œä¸­æ‰€æœ‰çš„ä¿¡æ¯
log-level: info # æ—¥å¿—ç­‰çº§
ipv6: true # å¯ç”¨ IPv6
#tls: # TLS ç›¸å…³é…ç½®
#  certificate: string # TLS è¯ä¹¦
#  private-key: string # TLS ç§é’¥
#  custom-certifactes: # è‡ªå®šä¹‰è¯ä¹¦
#    - |
#      -----BEGIN CERTIFICATE-----
#      format/pem...
#      -----END CERTIFICATE-----

external-controller: 0.0.0.0:9093 # å¤–éƒ¨æ§åˆ¶ç«¯å£
#external-controller-tls: 0.0.0.0:9443 # TLS å¤–éƒ¨æ§åˆ¶ç«¯å£
secret: "" # æ§åˆ¶æ¥å£å¯†é’¥

# RESTful API CORSæ ‡å¤´é…ç½®
external-controller-cors: # CORS é…ç½®
  allow-origins: #å…è®¸æ¥æº
    - http://localhost:*
    - http://127.0.0.1:*
  allow-private-network: true # å…è®¸ç§æœ‰ç½‘ç»œè®¿é—®
#external-controller-unix: mihomo.sock  # Unix Socket æ§åˆ¶æ¥å£
#external-controller-pipe: \\.\pipe\mihomo  # Windows ç®¡é“æ¥å£

unified-delay: true # å¼€å¯ç»Ÿä¸€å»¶è¿Ÿæ—¶
tcp-concurrent: true # å¯ç”¨ TCP å¹¶å‘è¿æ¥
external-ui: ui # å¤–éƒ¨ UI ç›®å½•
external-ui-name: xd # å¤–éƒ¨ UI åç§°
external-ui-url: "https://ghfast.top/github.com/Zephyruso/zashboard/releases/latest/download/dist.zip" # å¤–éƒ¨ UI ä¸‹è½½é“¾æ¥
external-doh-server: /dns-query # å¤–éƒ¨ DoH æœåŠ¡å™¨
#interface-name:  # ä½¿ç”¨çš„ç½‘ç»œæ¥å£åç§°
#routing-mark:  # è·¯ç”±æ ‡è®°
global-client-fingerprint: chrome # å…¨å±€å®¢æˆ·ç«¯æŒ‡çº¹ä¸º Chrome

# ç¼“è§£ç§»åŠ¨è®¾å¤‡è€—ç”µé—®é¢˜
# https://github.com/vernesong/OpenClash/issues/2614
disable-keep-alive: true # ç¦ç”¨ TCP Keep Aliveï¼Œåœ¨ Android é»˜è®¤ä¸º true
keep-alive-idle: 15 # Keep-Alive ç©ºé—²æ—¶é—´ (å•ä½: ç§’)
keep-alive-interval: 15 # Keep-Alive é—´éš”æ—¶é—´ (å•ä½: ç§’)

# å®éªŒæ€§åŠŸèƒ½é…ç½®
experimental:
  quic-go-disable-gso: true # ç¦ç”¨ QUIC åè®®ä¸­çš„ GSO (Generic Segmentation Offload) åŠŸèƒ½
  quic-go-disable-ecn: true #ç¦ç”¨ECN
  dialer-ip4p-convert: false # å¯ç”¨IP4Påœ°å€è½¬æ¢

# æœ¬åœ° DNS è§£æé…ç½®
hosts:
  ntp.ntsc.ac.cn: 
    - 114.118.7.161
    - 114.118.7.163

# ç¼“å­˜
profile:
  store-selected: true # å­˜å‚¨å·²é€‰æ‹©çš„ä»£ç†ç»„
  store-fake-ip: true # å­˜å‚¨ Fake IP åœ°å€

# ç½‘ç»œæ—¶é—´åè®® (NTP) è®¾ç½®
ntp:
  enable: false # å¯ç”¨ NTP åŠŸèƒ½
  write-to-system: false # å°†åŒæ­¥çš„æ—¶é—´å†™å…¥ç³»ç»Ÿæ—¶é’Ÿï¼Œéœ€rootæƒé™
  server: ntp.ntsc.ac.cn # NTP æœåŠ¡å™¨åœ°å€
  port: 123 # NTP æœåŠ¡å™¨ç«¯å£ï¼Œé»˜è®¤ä½¿ç”¨ 123 ç«¯å£
  interval: 30 # åŒæ­¥æ—¶é—´çš„é—´éš” (å•ä½: åˆ†é’Ÿ)

# sniffer é…ç½®ï¼šç”¨äºæ£€æµ‹å’Œå¤„ç†ä¸åŒåè®®çš„æµé‡
sniffer:
  enable: true # æ˜¯å¦å¯ç”¨ sniffer ä¾¦æµ‹åŠŸèƒ½ï¼Œé»˜è®¤å…³é—­
  force-dns-mapping: true # å¯¹ redir-host ç±»å‹è¯†åˆ«çš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  parse-pure-ip: true # å¯¹æ‰€æœ‰æœªè·å–åˆ°åŸŸåçš„æµé‡è¿›è¡Œå¼ºåˆ¶å—…æ¢
  override-destination: false # æ˜¯å¦ä½¿ç”¨å—…æ¢ç»“æœä½œä¸ºå®é™…è®¿é—®ï¼Œé»˜è®¤ä¸º true
  sniff:
    HTTP:
      ports: [80, 8080-8880] # å¯¹ HTTP æµé‡è¿›è¡Œå—…æ¢çš„ç«¯å£èŒƒå›´ï¼Œå¸¸ç”¨äºç½‘ç«™å’Œåº”ç”¨
      override-destination: true # è¦†ç›–ç›®æ ‡åœ°å€ä»¥å¼ºåˆ¶æµé‡èµ°ä»£ç†æˆ–è§„åˆ™åŒ¹é…
    TLS:
      ports: [443, 8443] # å¯¹ HTTPS æµé‡çš„ç«¯å£è¿›è¡Œå—…æ¢ï¼Œé€šå¸¸ç”¨äºåŠ å¯†è¿æ¥
    QUIC:
      ports: [443, 8443] # å¯¹ QUIC åè®®çš„æµé‡è¿›è¡Œå—…æ¢ï¼ŒQUI C å¸¸ç”¨äºæ”¹è¿› HTTPS è¿æ¥çš„é€Ÿåº¦
  force-domain:
    - "+.v2ex.com" # å¯¹æŒ‡å®šåŸŸåå¼ºåˆ¶è§£æï¼Œå³ä½¿ IP åœ°å€å·²ç¼“å­˜æˆ–å·²çŸ¥
  skip-domain:
    - Mijia.Cloud.com # è·³è¿‡æŒ‡å®šåŸŸåï¼Œä¸å¯¹å…¶è¿›è¡Œå—…æ¢å¤„ç†ï¼ˆå¦‚æ™ºèƒ½å®¶å±…æµé‡ï¼‰
  skip-src-address:
    - 192.168.0.3/32 # è·³è¿‡æ¥æº IP åœ°å€ï¼Œä¸å¯¹å…¶è¿›è¡Œå—…æ¢
  skip-dst-address:
    - 192.168.0.3/32 # è·³è¿‡ç›®æ ‡ IP åœ°å€ï¼Œä¸å¯¹å…¶è¿›è¡Œå—…æ¢

# tun é…ç½®ï¼šç”¨äºå¯ç”¨ TUN æ¨¡å¼ï¼Œä¼˜åŒ–æµé‡è·¯ç”±å’Œ IP è®¾ç½®
tun:
  enable: true # å¯ç”¨ TUN æ¨¡å¼ï¼Œç”¨äºé€æ˜ä»£ç†
  stack: gvisor # ä½¿ç”¨ç©ºé—´ç½‘ç»œæ ˆå¤„ç†æµé‡ï¼Œå¯ç”¨å€¼ï¼š system/gvisor/mixed
  auto-route: true # è‡ªåŠ¨è®¾ç½®å…¨å±€è·¯ç”±ï¼Œå¯ä»¥è‡ªåŠ¨å°†å…¨å±€æµé‡è·¯ç”±è¿›å…¥ tun ç½‘å¡ã€‚
#  auto-redirect: true # è‡ªåŠ¨é…ç½® iptables/nftables ä»¥é‡å®šå‘ TCP è¿æ¥, éœ€è¦auto-routeå·²å¯ç”¨, éœ€è¦rootæƒé™
  auto-detect-interface: true # è‡ªåŠ¨é€‰æ‹©æµé‡å‡ºå£æ¥å£ï¼Œå¤šå‡ºå£ç½‘å¡åŒæ—¶è¿æ¥çš„è®¾å¤‡å»ºè®®æ‰‹åŠ¨æŒ‡å®šå‡ºå£ç½‘å¡
  dns-hijack:
    - any:53 # åŠ«æŒæ‰€æœ‰ 53 ç«¯å£çš„ DNS è¯·æ±‚
  device: utun0 # æŒ‡å®š TUN è®¾å¤‡åç§°ï¼Œé»˜è®¤ä¸º utun
  mtu: 1500 # è®¾ç½®æœ€å¤§ä¼ è¾“å•å…ƒ (MTU)ï¼Œæé«˜ç½‘ç»œååé‡
  strict-route: true # å¯ç”¨ auto-route æ—¶æ‰§è¡Œä¸¥æ ¼çš„è·¯ç”±è§„åˆ™
  gso: true # é€šç”¨åˆ†æ®µå¸è½½ (GSO)ï¼Œæé«˜ç½‘ç»œæ€§èƒ½
  gso-max-size: 65536 # è®¾ç½® GSO æœ€å¤§åˆ†æ®µå¤§å°ä¸º 65536 å­—èŠ‚
  udp-timeout: 300 # è®¾ç½® UDP è¶…æ—¶æ—¶é—´ä¸º 300 ç§’ï¼Œä¼˜åŒ– NAT æ˜ å°„
#  iproute2-table-index: 2022 # ä½¿ç”¨æŒ‡å®šçš„è·¯ç”±è¡¨ç´¢å¼• (iproute2)
#  iproute2-rule-index: 9000 # è®¾ç½®è·¯ç”±è§„åˆ™çš„ç´¢å¼• (iproute2)
  endpoint-independent-nat: false # å¯ç”¨ç‹¬ç«‹äºç«¯ç‚¹çš„ NATï¼Œæ€§èƒ½å¯èƒ½ä¼šç•¥æœ‰ä¸‹é™ï¼Œæ‰€ä»¥ä¸å»ºè®®åœ¨ä¸éœ€è¦çš„æ—¶å€™å¼€å¯

# DNS é…ç½®ï¼šæ§åˆ¶ DNS æŸ¥è¯¢è¡Œä¸ºï¼Œæ”¯æŒå¢å¼ºæ¨¡å¼å’Œå‡ IP åŠŸèƒ½
# æŸ¥è¯¢ DNS æ˜¯å¦æ”¯æŒ H3 æŒ‡ä»¤:
#  curl https://1.1.1.1/dns-query --http3-only -vI
#  q www.baidu.com @https://1.1.1.1/dns-query --http3
dns:
  enable: true # å¯ç”¨ DNS æ¨¡å—
  cache-algorithm: arc # ç¼“å­˜ç®—æ³•ï¼Œå‚æ•°:lru æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œarc è‡ªé€‚åº”æ›¿æ¢ç¼“å­˜
  prefer-h3: false # DOH ä¼˜å…ˆä½¿ç”¨ http/3
  use-hosts: true # ä½¿ç”¨é…ç½®ä¸­çš„ hosts æ–‡ä»¶æ¡ç›®
  use-system-hosts: true # ä½¿ç”¨ç³»ç»Ÿçš„ hosts æ–‡ä»¶æ¡ç›®
  respect-rules: true # dns è¿æ¥éµå®ˆè·¯ç”±è§„åˆ™ï¼Œéœ€é…ç½® proxy-server-nameserver, å¼ºçƒˆä¸å»ºè®®å’Œ prefer-h3 ä¸€èµ·ä½¿ç”¨
  listen: 0.0.0.0:1053 # æœ¬åœ° DNS ç›‘å¬ç«¯å£ï¼Œé»˜è®¤æ˜¯ 1053 ç«¯å£
  ipv6: true # å¯ç”¨ IPv6 DNS è§£æï¼Œé¿å… IPv6 åœ°å€çš„è§£æè¯·æ±‚
  default-nameserver:
    - quic://223.5.5.5 # é˜¿é‡Œ DNS è§£æ DNS åŸŸå
    - quic://223.6.6.6 # é˜¿é‡Œ DNS è§£æ DNS åŸŸå
  enhanced-mode: fake-ip # å¯ç”¨å¢å¼ºæ¨¡å¼ redir-host or fake-ip
  fake-ip-range: 198.18.0.0/16 # fake-ip æ± è®¾ç½®
  fake-ip-filter-mode: blacklist
  fake-ip-filter:
    - geosite:private
    - adguardteam.github.io
    - adrules.top
    - amobile.music.tc.qq.com
    - anti-ad.net
    - api-jooxtt.sanook.com
    - api.joox.com
    - aqqmusic.tc.qq.com
    - dl.stream.qqmusic.qq.com
    - ff.dorado.sdo.com
    - heartbeat.belkin.com
    - isure.stream.qqmusic.qq.com
    - joox.com
    - lens.l.google.com
    - local.adguard.org
    - localhost.ptlogin2.qq.com
    - localhost.sec.qq.com
    - mesu.apple.com
    - mobileoc.music.tc.qq.com
    - music.taihe.com
    - musicapi.taihe.com
    - na.b.g-tun.com
    - proxy.golang.org
    - ps.res.netease.com
    - shark007.net
    - songsearch.kugou.com
    - static.adtidy.org
    - streamoc.music.tc.qq.com
    - stun.l.google.com
    - swcdn.apple.com
    - swdist.apple.com
    - swdownload.apple.com
    - swquery.apple.com
    - swscan.apple.com
    - time-ios.apple.com
    - time1.cloud.tencent.com
    - trackercdn.kugou.com
    - xnotify.xboxlive.com
    - "*.*.xboxlive.com"
    - +.stun.*.*
    - +.stun.*.*.*
    - +.stun.*.*.*.*
    - +.stun.*.*.*.*.*
    - localhost.*.weixin.qq.com
    - ntp.*.com
    - ntp1.*.com
    - ntp2.*.com
    - ntp3.*.com
    - ntp4.*.com
    - ntp5.*.com
    - ntp6.*.com
    - ntp7.*.com
    - stun.*.*
    - stun.*.*.*
    - time.*.apple.com
    - time.*.com
    - time.*.edu.cn
    - time.*.gov
    - time1.*.com
    - time2.*.com
    - time3.*.com
    - time4.*.com
    - time5.*.com
    - time6.*.com
    - time7.*.com
    - xbox.*.*.microsoft.com
    - xbox.*.microsoft.com
    - +.126.net
    - +.3gppnetwork.org
    - +.battle.net
    - +.battlenet.com.cn
    - +.cdn.nintendo.net
    - +.cmbchina.com
    - +.cmbimg.com
    - +.direct
    - +.example
    - +.ff14.sdo.com
    - +.ffxiv.com
    - +.finalfantasyxiv.com
    - +.gcloudcs.com
    - +.gcloudsdk.com
    - +.home.arpa
    - +.invalid
    - +.kuwo.cn
    - +.lan
    - +.linksys.com
    - +.linksyssmartwifi.com
    - +.local
    - +.localdomain
    - +.localhost
    - +.market.xiaomi.com
    - +.mcdn.bilivideo.cn
    - +.media.dssott.com
    - +.msftconnecttest.com
    - +.msftncsi.com
    - +.music.163.com
    - +.music.migu.cn
    - +.n0808.com
    - +.nflxvideo.net
    - +.ntp.org.cn
    - +.oray.com
    - +.orayimg.com
    - +.pool.ntp.org
    - +.router.asus.com
    - +.sandai.net
    - +.square-enix.com
    - +.srv.nintendo.net
    - +.steamcontent.com
    - +.stun.playstation.net
    - +.test
    - +.time.edu.cn
    - +.uu.163.com
    - +.wargaming.net
    - +.wggames.cn
    - +.wotgame.cn
    - +.wowsgame.cn
    - +.xiami.com
    - +.y.qq.com
  nameserver-policy:
    github.akams.cn:
      - "quic://223.5.5.5"
      - "quic://223.6.6.6"
    "+.jp":
      - "https://public.dns.iij.jp/dns-query#h3=true" # IIJ ï¼ˆæ—¥æœ¬ï¼‰ DNS over H3
    "+.hk":
      - "quic://dns.nextdns.io" # NextDNSï¼ˆé¦™æ¸¯ï¼‰ DNS over DOQ
    "+.eu":
      - "quic://dns0.eu" # å…¬å…±ï¼ˆæ¬§æ´²ï¼‰ DNS over DOQ
    "geosite:private,CN":
      - "quic://223.5.5.5" # é˜¿é‡Œ DNS over DOQ
      - "quic://223.6.6.6"
  nameserver:
    - "https://1.1.1.1/dns-query#h3=true" # Cloudflare DNS over H3
    - "https://1.0.0.1/dns-query#h3=true"
    - "https://8.8.8.8/dns-query#h3=true" # Google DNS over H3
    - "https://8.8.4.4/dns-query#h3=true"
#    - "https://185.222.222.222/dns-query#h3=true" # SB DNS over H3
#    - "https://45.11.45.11/dns-query#h3=true"
    - "quic://94.140.15.15" # AdGuard DNS over DOQ
    - "quic://94.140.14.140"
  proxy-server-nameserver: # ä»£ç†èŠ‚ç‚¹åŸŸåè§£ææœåŠ¡å™¨ï¼Œä»…ç”¨äºè§£æä»£ç†èŠ‚ç‚¹çš„åŸŸå
    - "quic://223.5.5.5" # é˜¿é‡Œ DNS over DOQ
    - "quic://223.6.6.6"
  direct-nameserver: #  ç”¨äºç›´è¿å‡ºå£åŸŸåè§£æçš„ DNS æœåŠ¡å™¨
    - "quic://223.5.5.5" # é˜¿é‡Œ DNS over DOQ
    - "quic://223.6.6.6"
  direct-nameserver-follow-policy: true # æ˜¯å¦éµå¾ª nameserver-policyï¼Œé»˜è®¤ä¸ºä¸éµå®ˆï¼Œä»…å½“ direct-nameserver ä¸ä¸ºç©ºæ—¶ç”Ÿæ•ˆ

proxies:
  - name: "ğŸ¯å…¨å±€ç›´è¿"
    type: direct
  - name: "ğŸš«æ‹’ç»è¿æ¥"
    type: reject
proxy-groups:
  - { name: ğŸš€å…¨çƒä»£ç†, type: select, proxies: [â™»ï¸è‡ªåŠ¨é€‰æ‹©, ğŸŸ¢æ‰‹åŠ¨é€‰æ‹©, âš¡ï¸å‡è¡¡è´Ÿè½½, ğŸ”¯æ•…éšœè½¬ç§», ğŸ¯å…¨å±€ç›´è¿, ğŸ‡­ğŸ‡°é¦™æ¸¯è‡ªåŠ¨, ğŸ‡¹ğŸ‡¼å°æ¹¾è‡ªåŠ¨, ğŸ‡¯ğŸ‡µæ—¥æœ¬è‡ªåŠ¨, ğŸ‡ºğŸ‡¸ç¾å›½è‡ªåŠ¨, ğŸ‡¸ğŸ‡¬æ–°åŠ å¡è‡ªåŠ¨, ğŸ‡¬ğŸ‡§è‹±å›½è‡ªåŠ¨, ğŸ‡©ğŸ‡ªå¾·å›½è‡ªåŠ¨, ğŸ‡«ğŸ‡·æ³•å›½è‡ªåŠ¨, ğŸ‡¨ğŸ‡¦åŠ æ‹¿å¤§è‡ªåŠ¨, ğŸ‡¦ğŸ‡ºæ¾³å¤§åˆ©äºšè‡ªåŠ¨, ğŸ‡°ğŸ‡·éŸ©å›½è‡ªåŠ¨, ğŸ‡·ğŸ‡ºä¿„ç½—æ–¯è‡ªåŠ¨, ğŸ‡³ğŸ‡±è·å…°è‡ªåŠ¨, ğŸ‡®ğŸ‡³å°åº¦è‡ªåŠ¨, ğŸ‡²ğŸ‡¾é©¬æ¥è¥¿äºšè‡ªåŠ¨, ğŸ‡µğŸ‡±æ³¢å…°è‡ªåŠ¨, ğŸ‡ªğŸ‡ªçˆ±æ²™å°¼äºšè‡ªåŠ¨, ğŸ‡¦ğŸ‡ªé˜¿è”é…‹è‡ªåŠ¨, ğŸ‡³ğŸ‡¬å°¼æ—¥åˆ©äºšè‡ªåŠ¨, ğŸ‡§ğŸ‡¬ä¿åŠ åˆ©äºšè‡ªåŠ¨, ğŸ‡¸ğŸ‡¨å¡èˆŒå°”è‡ªåŠ¨, ğŸ‡ªğŸ‡¸è¥¿ç­ç‰™è‡ªåŠ¨, ğŸ‡»ğŸ‡³è¶Šå—è‡ªåŠ¨, ğŸ‡¸ğŸ‡½è·å±åœ£é©¬ä¸è‡ªåŠ¨, ğŸ‡²ğŸ‡´æ¾³é—¨è‡ªåŠ¨, ğŸ‡µğŸ‡­è²å¾‹å®¾è‡ªåŠ¨, ğŸ‡¹ğŸ‡­æ³°å›½è‡ªåŠ¨, ğŸ‡²ğŸ‡³è’™å¤è‡ªåŠ¨, ğŸ‡«ğŸ‡®èŠ¬å…°è‡ªåŠ¨, ğŸ‡¸ğŸ‡ªç‘å…¸è‡ªåŠ¨, ğŸ‡¦ğŸ‡¹å¥¥åœ°åˆ©è‡ªåŠ¨, ğŸ‡§ğŸ‡·å·´è¥¿è‡ªåŠ¨, ğŸ‡°ğŸ‡¿å“ˆè¨å…‹æ–¯å¦è‡ªåŠ¨, ğŸ‡®ğŸ‡±ä»¥è‰²åˆ—è‡ªåŠ¨, ğŸ‡¦ğŸ‡ªé˜¿æ‹‰ä¼¯è”åˆé…‹é•¿å›½è‡ªåŠ¨,  ğŸ‡¨ğŸ‡­ç‘å£«è‡ªåŠ¨, ğŸŒå…¶å®ƒåœ°åŒº], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸŸ¢æ‰‹åŠ¨é€‰æ‹©, <<: *u, type: select, exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸª§å¹¿å‘Šæ‹¦æˆª, type: select, include-all: true, proxies: [ğŸš«æ‹’ç»è¿æ¥, ğŸš€å…¨çƒä»£ç†, ğŸ¯å…¨å±€ç›´è¿], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸ’§æ³„æ¼æ‹¦æˆª, type: select, include-all: true, proxies: [ğŸš«æ‹’ç»è¿æ¥, ğŸš€å…¨çƒä»£ç†, ğŸ¯å…¨å±€ç›´è¿], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸ¯å…¨çƒç›´è¿, type: select, include-all: true, proxies: [ğŸ¯å…¨å±€ç›´è¿, ğŸš€å…¨çƒä»£ç†], exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: â™»ï¸è‡ªåŠ¨é€‰æ‹©, <<: *u, tolerance: 1, type: url-test, exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: âš¡ï¸å‡è¡¡è´Ÿè½½, <<: *u, strategy: round-robin, type: load-balance, exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸ”¯æ•…éšœè½¬ç§», <<: *u, type: fallback, exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
  - { name: ğŸ‡­ğŸ‡°é¦™æ¸¯è‡ªåŠ¨, <<: *u, hidden: true, filter: (?i)ğŸ‡­ğŸ‡°|\\bHK\\b|é¦™æ¸¯|Hong Kong }
  - { name: ğŸ‡¹ğŸ‡¼å°æ¹¾è‡ªåŠ¨, <<: *u, hidden: true, filter: '(?i)ğŸ‡¹ğŸ‡¼|\bTW\b|å°æ¹¾|Taiwan|Tai wan' }
  - { name: ğŸ‡¯ğŸ‡µæ—¥æœ¬è‡ªåŠ¨, <<: *u, hidden: true, filter: '(?i)ğŸ‡¯ğŸ‡µ|\bJP\b|æ—¥æœ¬|Japan' }
  - { name: ğŸ‡ºğŸ‡¸ç¾å›½è‡ªåŠ¨, <<: *u, hidden: true, filter: '(?i)ğŸ‡ºğŸ‡¸|\bUS\b|ç¾å›½|United States|CT' }
  - { name: ğŸ‡¸ğŸ‡¬æ–°åŠ å¡è‡ªåŠ¨, <<: *u, hidden: true, filter: '(?i)ğŸ‡¸ğŸ‡¬|\bSG\b|æ–°åŠ å¡|Singapore' }
  - { name: ğŸ‡°ğŸ‡·éŸ©å›½è‡ªåŠ¨, <<: *u, hidden: true, filter: '(?i)ğŸ‡°ğŸ‡·|\bKR\b|éŸ©å›½|South Korea' }
  - { name: ğŸŒå…¶å®ƒåœ°åŒº, <<: *u, type: select, exclude-filter: '(?i)^.*(?:ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥|ğŸ‡¨ğŸ‡³|\bCN\b|ä¸­å›½|China|
        â€|ğŸ‡­ğŸ‡°|\bHK\b|é¦™æ¸¯|Hong Kong|
        â€|ğŸ‡¹ğŸ‡¼|\bTW\b|å°æ¹¾|Taiwan|Tai wan|
        â€|ğŸ‡¯ğŸ‡µ|\bJP\b|æ—¥æœ¬|Japan|
        â€|ğŸ‡ºğŸ‡¸|\bUS\b|ç¾å›½|United States|CT|
        â€|ğŸ‡¸ğŸ‡¬|\bSG\b|æ–°åŠ å¡|Singapore|
        â€|ğŸ‡°ğŸ‡·|\bKR\b|éŸ©å›½|South Korea).*$' }
  - { name: GLOBAL, type: select, include-all: true, proxies: [ ğŸš€å…¨çƒä»£ç†, ğŸŸ¢æ‰‹åŠ¨é€‰æ‹©, ğŸª§å¹¿å‘Šæ‹¦æˆª, ğŸ’§æ³„æ¼æ‹¦æˆª, ğŸ¯å…¨çƒç›´è¿, â™»ï¸è‡ªåŠ¨é€‰æ‹©, âš¡ï¸å‡è¡¡è´Ÿè½½, ğŸ”¯æ•…éšœè½¬ç§», ğŸŒå…¶å®ƒåœ°åŒº ], icon: https://cdn.jsdmirror.cn/gh/Kwisma/cf-worker-mihomo@main/icon/webp/100/GLOBAL.webp, exclude-filter: (?i)ğŸ¯å…¨å±€ç›´è¿|ğŸš«æ‹’ç»è¿æ¥ }
rules:
  - GEOSITE,private,ğŸ¯å…¨çƒç›´è¿
  - RULE-SET,Advertising-ads,ğŸª§å¹¿å‘Šæ‹¦æˆª
  - RULE-SET,STUN,ğŸ’§æ³„æ¼æ‹¦æˆª
  - DST-PORT,3478,ğŸ’§æ³„æ¼æ‹¦æˆª
  - AND,(NETWORK,TCP),(DST-PORT,5349),ğŸ’§æ³„æ¼æ‹¦æˆª
  - AND,(NETWORK,UDP),(DST-PORT,5350),ğŸ’§æ³„æ¼æ‹¦æˆª
  - AND,(NETWORK,UDP),(DST-PORT,5351),ğŸ’§æ³„æ¼æ‹¦æˆª
  - AND,(NETWORK,UDP),(DST-PORT,19302),ğŸ’§æ³„æ¼æ‹¦æˆª
  - DOMAIN-KEYWORD,stun,ğŸ’§æ³„æ¼æ‹¦æˆª
  - GEOIP,CN,ğŸ¯å…¨çƒç›´è¿
  - MATCH,ğŸš€å…¨çƒä»£ç†
rule-providers:
  Advertising-ads:
    <<: *domain_mrs
    url: "https://cdn.jsdmirror.cn/gh/TG-Twilight/AWAvenue-Ads-Rule@main/Filters/AWAvenue-Ads-Rule-Clash.mrs"
    path: ./ruleset/Advertising_ads_Domain.mrs
  STUN:
    <<: *domain_mrs
    url: "https://cdn.jsdmirror.cn/gh/Kwisma/cf-worker-mihomo@main/rules/mihomo/STUN/STUN_Domain.mrs"
    path: ./ruleset/STUN_Domain.mrs
